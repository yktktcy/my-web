<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>FoodCalender</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
  
  body {
    /* font-family: "Noto Sans JP", sans-serif;
    margin: 20px; */
    font-family: "Noto Sans JP", sans-serif;
    text-align: center;
    margin: 0;
    padding: 0;
    background: linear-gradient(0deg, #40120b, #f2a24a);
    min-height: 100vh; /* 画面全体の高さを確保 */
    position: relative; /* 背景の装飾(shape)を配置するため */
    overflow: hidden; 
    /* スクロールバーを隠す */
  }
    /* カーソルを表示しない */
  *{
    cursor: none !important;
  }
  /* カスタムカーソルのスタイル */ 
  #custom-cursor { 
    position: absolute; 
    top: 0; 
    left: 0;
    width: 15px; 
    height: 15px; 
    background: rgba(255, 255, 255, 1.0);
    border: 1px solid #8c2d1c; 
    border-radius: 50%; 
    pointer-events: none; /* カーソルがクリック判定を邪魔しないように */
    z-index: 9999; 
    transform: translate(-50%, -50%); /* カーソルの中心に位置合わせ */
    transition: transform 0.05s ease; /* 動きに滑らかさを追加 */
  } 


  /* 背景の装飾 */
.background-shapes {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1; /* カレンダーより後ろに置く */
  pointer-events: none;
}

/* 円の共通設定 */
.bg-shape-circle {
  position: absolute;
  border-radius: 50%;
  opacity: 0.15;
}

/* 円ごとの色・サイズ */
.circle1 {
  width: 300px;
  height: 300px;
  background: #bf3e2f;
  top: 10%;
  left: 10%;
}

.circle2 {
  width: 200px;
  height: 200px;
  background: #8c2d1c;
  top: 60%;
  left: 70%;
}

.circle3 {
  width: 150px;
  height: 150px;
  background: #d95f2e;
  top: 30%;
  left: 50%;
}

/* タイトル */
  h2 {
    margin-top: 0px;
    color: #fff;
    margin-bottom: 0px;
  }
  label {
    color: #ffffff;
  }
  p {
    color: #ffffff;
  }



a.button,
button {
  display: inline-block;
  padding: 6px 12px;
  /* background: #8c2d1c; */
  color: white;
  text-decoration: none;
  border-radius: 6px;
  font-size: 12px;
  transition: background 0.3s ease;
  cursor: pointer;

  /* ▼ これが重要：button のデフォルトを消す */
  border: none;
  outline: none;
  line-height: 1.2; /* a と揃える */
  box-sizing: border-box;

  margin: 4px; /* ボタン間の余白 */
}

a.button:hover,
button:hover {
  background: #f2a24a;
}

a.button{
  background: #40120b;
}

button{
  background: #8c2d1c;
}

  table { border-collapse: collapse; width: 100%; }
  th, td {
    border: 1px solid #c6c6c6;
    width: 12%;
    vertical-align: middle;
    padding: 4px;
  }

  /* ★ 左端の分類ラベル（上下左右中央） */
  th:first-child, td:first-child {
    width: 10%;
    font-weight: bold;
    background: #f5f5f5;
    text-align: center;
    vertical-align: middle;
  }

  .cell-container {
    display: grid;
    gap: 2px;
  }

  .img-tile {
    width: 100%;
    height: auto;
    cursor: pointer;
    box-sizing: border-box;
  }

  /* ★ p/q/r/s の枠線色 */
  .img-p { border: 3px solid #40120b; } /* （自宅A） */
  .img-q { border: 3px solid #bf3e2f; } /* （自宅B） */
  .img-r { border: 3px solid #d95f2e; } /* （自宅C） */
  .img-s { border: 3px solid #f2a24a; } /* （外食） */

  /* ★ NO IMAGE */
  .no-image {
    background: #ddd;
    color: #555;
    font-size: 12px;
    text-align: center;
    vertical-align: middle;
    height: 60px;
  }

  #week-range { font-weight: bold; margin: 10px 0; }

  /* ★ 追加：ヘッダーの日曜・土曜だけ色付け */
  th.sunday-header { background: #da5e5e; }
  th.weekday-header { background: #f5f5f5;}
  th.saturday-header { background: #5d8ccf; }

  /* ★ Lightbox */
  #lightbox {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.8);
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }

  #lightbox img {
    max-width: 90%;
    max-height: 90%;
    border-radius: 6px;
  }
</style>
</head>
<body>
<!-- 背景の円 --> 
<div class="background-shapes">
   <div class="bg-shape-circle circle1"></div> 
   <div class="bg-shape-circle circle2"></div> 
   <div class="bg-shape-circle circle3"></div> 
</div>
<a href="index.html" class="button">前のページへ</a>
<button onclick="goToThisWeek()">今週を表示</button>
<button onclick="prevWeek()">前週</button>
<button onclick="nextWeek()">次週</button>
<input type="date" id="input-date" onchange="updateWeek()">
<h2>食事カレンダー</h2>
<p id="week-range"></p>
<table id="image-table">
  <thead>
    <tr>
      <th>分類</th>
      <th class="sunday-header">日</th>
      <th class="weekday-header">月</th>
      <th class="weekday-header">火</th>
      <th class="weekday-header">水</th>
      <th class="weekday-header">木</th>
      <th class="weekday-header">金</th>
      <th class="saturday-header">土</th>
    </tr>
  </thead>
  <tbody id="table-body"></tbody>
</table>

<!-- ★ Lightbox 要素 -->
<div id="lightbox" onclick="closeLightbox()">
  <img id="lightbox-img" src="">
</div>

<script>
// ------------------------------
// 設定
// ------------------------------
const X_VALUES = ["a", "b", "c", "z"];
const Y_VALUES = ["p", "q", "r", "s"];

const X_LABELS = {
  a: "朝ごはん",
  b: "昼ごはん",
  c: "夜ごはん",
  z: "その他"
};

let currentStartDate = null;

// ------------------------------
function getWeekRange(date) {
  const d = new Date(date);
  const day = d.getDay();
  const sunday = new Date(d);
  sunday.setDate(d.getDate() - day);

  const saturday = new Date(sunday);
  saturday.setDate(sunday.getDate() + 6);

  return { start: sunday, end: saturday };
}

// ------------------------------
function formatDate(d) {
  const y = d.getFullYear();
  const m = ("0" + (d.getMonth() + 1)).slice(-2);
  const day = ("0" + d.getDate()).slice(-2);
  return `${y}${m}${day}`;
}

// ------------------------------
async function loadImagesForCell(dateStr, x) {
  const images = [];

  for (const y of Y_VALUES) {
    for (let i = 0; i < 1000; i++) {
      const n = String(i).padStart(3, "0");
      const filename = `data-low/${dateStr}_${x}_${y}_${n}.jpg`;

      try {
        const res = await fetch(filename, { method: "HEAD" });
        if (res.ok) {
          images.push(filename);
        } else {
          break;
        }
      } catch {
        break;
      }
    }
  }

  return images;
}

// ------------------------------
async function generateTable(startDate) {
  const tbody = document.getElementById("table-body");
  tbody.innerHTML = "";

  for (const x of X_VALUES) {
    const tr = document.createElement("tr");

    const labelTd = document.createElement("td");
    labelTd.textContent = X_LABELS[x];
    tr.appendChild(labelTd);

    for (let offset = 0; offset < 7; offset++) {
      const cellDate = new Date(startDate);
      cellDate.setDate(startDate.getDate() + offset);
      const dateStr = formatDate(cellDate);

      const td = document.createElement("td");
      const cellImages = await loadImagesForCell(dateStr, x);

      if (cellImages.length > 0) {
        const tileCount = Math.ceil(Math.sqrt(cellImages.length));
        const container = document.createElement("div");
        container.className = "cell-container";
        container.style.gridTemplateColumns = `repeat(${tileCount}, 1fr)`;

        cellImages.forEach(src => {
          const img = document.createElement("img");
          img.src = src;
          img.className = "img-tile";

          // ★ y を抽出して枠線色クラスを付与
          const y = src.split("_")[2];
          img.classList.add(`img-${y}`);

          // ★ Lightbox 用クリックイベント
          img.onclick = () => openLightbox(src);

          container.appendChild(img);
        });

        td.appendChild(container);
      } else {
        td.className = "no-image";
        td.textContent = "No Image";
      }

      tr.appendChild(td);
    }

    tbody.appendChild(tr);
  }
}

// ------------------------------
async function updateWeek() {
  const input = document.getElementById("input-date").value;
  if (!input) return;

  const { start, end } = getWeekRange(input);
  currentStartDate = start;

  document.getElementById("week-range").textContent =
    `${start.toLocaleDateString()} 〜 ${end.toLocaleDateString()}`;

  await generateTable(start);
}

// ------------------------------
async function prevWeek() {
  if (!currentStartDate) return;

  currentStartDate = new Date(currentStartDate.getTime() - 7 * 86400000);
  const end = new Date(currentStartDate.getTime() + 6 * 86400000);

  document.getElementById("week-range").textContent =
    `${currentStartDate.toLocaleDateString()} 〜 ${end.toLocaleDateString()}`;

  await generateTable(currentStartDate);
}

// ------------------------------
async function nextWeek() {
  if (!currentStartDate) return;

  currentStartDate = new Date(currentStartDate.getTime() + 7 * 86400000);
  const end = new Date(currentStartDate.getTime() + 6 * 86400000);

  document.getElementById("week-range").textContent =
    `${currentStartDate.toLocaleDateString()} 〜 ${end.toLocaleDateString()}`;

  await generateTable(currentStartDate);
}

// ------------------------------
async function goToThisWeek() {
  const today = new Date();
  const { start, end } = getWeekRange(today);

  currentStartDate = start;

  document.getElementById("week-range").textContent =
    `${start.toLocaleDateString()} 〜 ${end.toLocaleDateString()}`;

  await generateTable(start);
}

// ------------------------------
// ★ Lightbox 機能
// ------------------------------
function openLightbox(src) {
  document.getElementById("lightbox-img").src = src;
  document.getElementById("lightbox").style.display = "flex";
}

function closeLightbox() {
  document.getElementById("lightbox").style.display = "none";
}
</script>
</body>
</html>
<!-- <script>
  const circles = document.querySelectorAll('.bg-shape-circle');

  circles.forEach(circle => floatAround(circle));

  function floatAround(circle) {
    const maxX = window.innerWidth - circle.offsetWidth;
    const maxY = window.innerHeight - circle.offsetHeight;

    const x = Math.random() * maxX;
    const y = Math.random() * maxY;

    const speed = 6000 + Math.random() * 4000;

    circle.animate(
      [{ transform: `translate(${x}px, ${y}px)` }],
      {
        duration: speed,
        fill: "forwards",
        easing: "ease-in-out"
      }
    ).onfinish = () => floatAround(circle);
  }
</script> -->
<!-- カスタムカーソルの要素 --> 
<div id="custom-cursor"></div> 
<script>
  const cursor = document.getElementById("custom-cursor");
  const circles = document.querySelectorAll('.bg-shape-circle');

  // カーソル追従
  document.addEventListener("mousemove", (e) => {
    cursor.style.top = `${e.clientY}px`;
    cursor.style.left = `${e.clientX}px`;
  });

  // ランダム移動開始
  circles.forEach(circle => floatAround(circle));

  // 画面内を自由に漂うランダム移動
  function floatAround(circle) {
    const maxX = window.innerWidth;
    const maxY = window.innerHeight;

    // ランダム座標
    const x = Math.random() * maxX - maxX / 2;
    const y = Math.random() * maxY - maxY / 2;

    // 円ごとに速度を変える（奥行き感）
    const speed = 6000 + Math.random() * 4000;

    circle.animate(
      [{ transform: `translate(${x}px, ${y}px)` }],
      {
        duration: speed,
        fill: "forwards",
        easing: "ease-in-out"
      }
    ).onfinish = () => floatAround(circle);
  }
</script>

<script> 
  window.onload = () => { goToThisWeek(); };
</script>